<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.ChartMapper">
    <select id="ordersList" resultType="hashmap">
        select orders_no, orders_id, users_name, photo_package_title, photo_package_amount, photo_package_price, (photo_package_amount*photo_package_price) package_total, 
			lend_costume_name, lend_costume_amount, lend_costume_price, (lend_costume_amount*lend_costume_price) costume_total, 
			orders_day, orders_paytype, users_point discount, (((photo_package_amount*photo_package_price)+(lend_costume_amount*lend_costume_price))-users_point) total
		from orders, photo_package, lend_costume , users
		where orders_package_code=photo_package_code and orders_costume_code=lend_costume_code and orders_id=users_id
		<if test="searchType=='photo_package_title'">
        	and photo_package_title like concat('%', #{keyword}, '%')
        </if>
        <if test="searchType=='lend_costume_name'">
        	and lend_costume_name like concat('%', #{keyword}, '%')
        </if>
        <if test="searchType=='orders_paytype'">
        	and orders_paytype like concat('%', #{keyword}, '%')
        </if>
        <if test="searchType=='orders_day'">
        	and MONTH(orders_day) like concat('%', #{keyword}, '%')
        </if>
        order by orders_day desc 
		limit #{pageStart}, #{perPageNum}
    </select>
    
    <select id="orderCount" resultType="int">
    	select count(*) from(select * from orders, photo_package, lend_costume , users
		where  orders_package_code=photo_package_code and orders_costume_code=lend_costume_code and orders_id=users_id) orders
		<if test="searchType=='photo_package_title'">
        	where orders_package_code=photo_package_code and orders_costume_code=lend_costume_code and orders_id=users_id
        	and photo_package_title like concat('%', #{keyword}, '%')
			order by orders_day desc 
        </if>
        <if test="searchType=='lend_costume_name'">
        	where orders_package_code=photo_package_code and orders_costume_code=lend_costume_code and orders_id=users_id
        	and lend_costume_name like concat('%', #{keyword}, '%')
			order by orders_day desc 
        </if>
        <if test="searchType=='orders_paytype'">
        	where orders_package_code=photo_package_code and orders_costume_code=lend_costume_code and orders_id=users_id
        	and orders_paytype like concat('%', #{keyword}, '%')
			order by orders_day desc 
        </if>
        <if test="searchType=='orders_day'">
        	where orders_package_code=photo_package_code and orders_costume_code=lend_costume_code and orders_id=users_id
        	and MONTH(orders_day) like concat('%', #{keyword}, '%')
			order by orders_day desc 
        </if>
    </select>
    
    
    
    <select id="packagechart" resultType="com.example.domain.ChartsVO">
        select photo_package_title name, (select count(orders_package_code) *photo_package_price) value
    	from orders o, photo_package p
    	where p.photo_package_code=o.orders_package_code
        	and MONTH(orders_day) like #{month}
    	group by photo_package_title
    	order by photo_package_title
    </select>
    
    <select id="packagechart2" resultType="com.example.domain.ChartsVO">
        select photo_package_title name, count(photo_package_amount) value
    	from orders o, photo_package p
    	where p.photo_package_code=o.orders_package_code
    		and MONTH(orders_day) like #{month}
    	group by photo_package_title
    	order by photo_package_title
    </select>
    
    <select id="costumechart" resultType="com.example.domain.ChartsVO">
        select lend_costume_name name, (select count(orders_costume_code) *lend_costume_price) value
    	from orders o, lend_costume l
    	where l.lend_costume_code=o.orders_costume_code
    		and MONTH(orders_day) like #{month}
    	group by lend_costume_name
    	order by lend_costume_name
    </select>
    
    <select id="costumechart2" resultType="com.example.domain.ChartsVO">
        select lend_costume_name name, count(lend_costume_amount) value
    	from orders o, lend_costume l
    	where l.lend_costume_code=o.orders_costume_code
    		and MONTH(orders_day) like #{month}
    	group by lend_costume_name
    	order by lend_costume_name
    </select>
    
</mapper>